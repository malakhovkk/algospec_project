# –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å SMTP (ETIMEDOUT)

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ—à–∏–±–∫–∏ ETIMEDOUT

–û—à–∏–±–∫–∞ `ETIMEDOUT` –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ SMTP —Å–µ—Ä–≤–µ—Ä—É –≤ —Ç–µ—á–µ–Ω–∏–µ 30 —Å–µ–∫—É–Ω–¥.

## ‚úÖ –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `backend/.env`

```env
SMTP_HOST=smtp.yandex.ru
SMTP_PORT=465
SMTP_USER=your-email@yandex.ru
SMTP_PASS=your-app-password
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å SMTP —Å–µ—Ä–≤–µ—Ä–∞

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:**

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–æ—Ä—Ç–∞ 465
telnet smtp.yandex.ru 465
# –∏–ª–∏
nc -zv smtp.yandex.ru 465

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞ 587
telnet smtp.yandex.ru 587
# –∏–ª–∏
nc -zv smtp.yandex.ru 587
```

**–ï—Å–ª–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è:**
- –ü—Ä–æ–≤–∞–π–¥–µ—Ä –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å SMTP –ø–æ—Ä—Ç—ã
- –§–∞–π—Ä–≤–æ–ª –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ö–æ–¥—è—â–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- Yandex –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤–∞—à IP –∞–¥—Ä–µ—Å

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DNS

```bash
nslookup smtp.yandex.ru
# –∏–ª–∏
dig smtp.yandex.ru
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å IP –∞–¥—Ä–µ—Å: `87.250.250.38` –∏–ª–∏ –ø–æ—Ö–æ–∂–∏–π.

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å —Ñ–∞–π—Ä–≤–æ–ª–∞
sudo ufw status

# –û–±—ã—á–Ω–æ –¥–ª—è –∏—Å—Ö–æ–¥—è—â–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —Ñ–∞–π—Ä–≤–æ–ª –Ω–µ –Ω—É–∂–µ–Ω
# –ù–æ –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å:
sudo ufw disable
# (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!)
```

### 5. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –ø–æ—Ä—Ç

**–î–ª—è Yandex:**
- –ü–æ—Ä—Ç 465 (SSL) - `SMTP_PORT=465`
- –ü–æ—Ä—Ç 587 (STARTTLS) - `SMTP_PORT=587`

**–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –≤ `.env`:**

```env
# –í–∞—Ä–∏–∞–Ω—Ç 1: SSL
SMTP_PORT=465

# –í–∞—Ä–∏–∞–Ω—Ç 2: STARTTLS (–µ—Å–ª–∏ 465 –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
SMTP_PORT=587
```

### 6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
ping 8.8.8.8

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Yandex
ping smtp.yandex.ru
```

### 7. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ SMTP —Å–µ—Ä–≤–∏—Å—ã

–ï—Å–ª–∏ Yandex –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã:

#### Gmail:
```env
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASS=your-app-password
```

#### Mail.ru:
```env
SMTP_HOST=smtp.mail.ru
SMTP_PORT=465
SMTP_USER=your-email@mail.ru
SMTP_PASS=your-app-password
```

#### Mailtrap (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è):
```env
SMTP_HOST=sandbox.smtp.mailtrap.io
SMTP_PORT=2525
SMTP_USER=your-mailtrap-user
SMTP_PASS=your-mailtrap-pass
```

### 8. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å –ø–æ–º–æ—â—å—é telnet

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ SMTP:**

```bash
# –î–ª—è –ø–æ—Ä—Ç–∞ 465 (SSL)
openssl s_client -connect smtp.yandex.ru:465 -starttls smtp

# –î–ª—è –ø–æ—Ä—Ç–∞ 587 (STARTTLS)
telnet smtp.yandex.ru 587
# –ó–∞—Ç–µ–º –≤–≤–µ–¥–∏—Ç–µ:
EHLO test
```

### 9. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –±—ç–∫–µ–Ω–¥–∞

–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –±—ç–∫–µ–Ω–¥–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:

```bash
pm2 logs algospec-backend | grep -i "smtp\|email\|cors"
```

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```
üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ SMTP –Ω–∞—Å—Ç—Ä–æ–µ–∫:
   SMTP_HOST: smtp.yandex.ru
   SMTP_PORT: 465
   SMTP_USER: —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (your-email@yandex.ru)
   SMTP_PASS: —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (***)
‚úÖ SMTP –Ω–∞—Å—Ç—Ä–æ–µ–Ω: smtp.yandex.ru:465 (secure: true)
```

### 10. –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

–ï—Å–ª–∏ SMTP –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∫–æ–¥ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤—Å–µ–≥–¥–∞ –≤—ã–≤–æ–¥–∏—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å:

```
============================================================
üìß –ö–û–î –í–ï–†–ò–§–ò–ö–ê–¶–ò–ò –î–õ–Ø USER@EMAIL.COM
üîë –ö–û–î: 123456
============================================================
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
```bash
pm2 logs algospec-backend | grep "–ö–û–î –í–ï–†–ò–§–ò–ö–ê–¶–ò–ò"
```

## üîß –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ü—Ä–æ–≤–∞–π–¥–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç SMTP –ø–æ—Ä—Ç—ã

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π SMTP —Å–µ—Ä–≤–∏—Å
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ–∫—Å–∏/VPN
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ—Ä—Ç 587 –≤–º–µ—Å—Ç–æ 465

### –ü—Ä–æ–±–ª–µ–º–∞ 2: Yandex –±–ª–æ–∫–∏—Ä—É–µ—Ç IP –∞–¥—Ä–µ—Å

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π SMTP —Å–µ—Ä–≤–∏—Å (Gmail, Mail.ru)
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Mailtrap –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ:**
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∞ –Ω–µ –æ–±—ã—á–Ω—ã–π –ø–∞—Ä–æ–ª—å
- –î–ª—è Yandex: https://id.yandex.ru/security/app-passwords
- –î–ª—è Gmail: https://myaccount.google.com/apppasswords

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –§–∞–π—Ä–≤–æ–ª –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∞–π—Ä–≤–æ–ª–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∞–π—Ä–≤–æ–ª–∞ —É –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## üìù –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. **–ü–µ—Ä–µ–∫–æ–º–ø–∏–ª–∏—Ä—É–π—Ç–µ –±—ç–∫–µ–Ω–¥:**
   ```bash
   cd backend
   npm run build
   ```

2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±—ç–∫–µ–Ω–¥:**
   ```bash
   pm2 restart algospec-backend
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   ```bash
   pm2 logs algospec-backend --lines 50
   ```

## üÜò –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç

1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π SMTP —Å–µ—Ä–≤–∏—Å (Gmail, Mail.ru, Mailtrap)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–æ–¥ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤—ã–≤–æ–¥–∏—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å (—ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤—Å–µ–≥–¥–∞)
3. –î–ª—è production —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:
   - SendGrid
   - Mailgun
   - Amazon SES
   - Yandex.Connect (–¥–ª—è –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤)

---

**–í–∞–∂–Ω–æ:** –ö–æ–¥ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –ª–æ–≥–∞—Ö, –¥–∞–∂–µ –µ—Å–ª–∏ email –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!

